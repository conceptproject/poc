<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AuthenticID WebSDK 5.x â€“ Simple Capture Demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; }
    .actions { display: flex; gap: .75rem; flex-wrap: wrap; margin-bottom: 1rem; }
    button { padding: .6rem .9rem; border-radius: .5rem; border: 1px solid #ccc; background: #fff; cursor: pointer; }
    button:disabled { opacity: .5; cursor: not-allowed; }
    .status { margin:.5rem 0 1rem; color:#444; font-size:.95rem }
    .previews { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap: 1rem; }
    figure { margin:0; border:1px solid #eee; padding:.75rem; border-radius:.5rem; background:#fafafa }
    figcaption { font-size:.85rem; color:#555; margin-top:.5rem; word-break: break-word; }
    img { width:100%; height:auto; display:block; background:#ddd; border-radius:.25rem }
    code { background:#f2f2f2; padding:.1rem .3rem; border-radius:.25rem }
  </style>
</head>
<body>
  <h1>AuthenticID WebSDK 5.x â€“ Simple Capture</h1>

  <div class="actions">
    <button id="btn-front" disabled>ðŸ“„ Capture Front</button>
    <button id="btn-back" disabled>ðŸ“„ Capture Back</button>
    <button id="btn-selfie" disabled>ðŸ¤³ Capture Selfie</button>
  </div>

  <div class="status" id="status">Loading SDKâ€¦</div>

  <div class="previews">
    <figure>
      <img id="img-front" alt="Front preview (cropped if available)" />
      <figcaption><strong>Front</strong> â€” <span id="meta-front">no capture yet</span></figcaption>
    </figure>
    <figure>
      <img id="img-back" alt="Back preview (cropped if available)" />
      <figcaption><strong>Back</strong> â€” <span id="meta-back">no capture yet</span></figcaption>
    </figure>
    <figure>
      <img id="img-selfie" alt="Selfie preview (cropped if available)" />
      <figcaption><strong>Selfie</strong> â€” <span id="meta-selfie">no capture yet</span></figcaption>
    </figure>
  </div>

  <!-- 1) Include the SDK (development build) -->
  <script src="./IDMetricsCaptureFramework-4.10.0-plain-code.js"></script>

  <script>
    // 2) Set up init hook required by the SDK
    let captureFw;

    window.onCaptureFrameworkLoaded = async function () {
      const detectionProvider = 1; // 1 is the only supported provider in >= 4.10.0
      const languageConfig = {
        lang: "en",
        localizedStrings: {
          notifications: {
            faceNotFound: "Face not aligned",
            tooManyFaces: "More than one face",
            moveAway: "Move away",
            moveCloser: "Move closer",
            onBlur: "Keep your phone steady to capture a clear image",
            onDark: "Please move to a brighter location or turn on more lights",
            onFaceAngleV2: "Align face within the white silhouette",
            removeLenses: "Take off your glasses",
            lenses: "Lenses detected",
            eyesClosed: "Eyes closed",
            mask: "Face mask detected",
            centerFaceV2: "Make sure you align the face within the silhouette",
            getReady: "Get ready and stay still..."
          },
          idv2: {
            capture: {
              autoCapture: "The photo will be taken automatically",
              dontMove: "Don't move your ID for a few seconds",
              fillFrameBack: "Fill the frame with your back ID",
              fillFrameFront: "Fill the frame with your ID",
              fillFramePassport: "Fill the frame with your passport",
              manualCapture: { ariaLabel: "Manual Capture", title: "Manual Capture Button" },
              notifications: {
                blur: { description: "Zoom in and out, or tap on the ID", title: "ID too blurry" },
                expiredId: "Expired ID document",
                glare: { description: "Find a better lighting to avoid reflections", title: "ID with glare" },
                notAligned: { description: "Center your ID inside the frame", title: "ID is not aligned" },
                showBack: { description: "Flip your ID to show its reverse side", title: "Show the back of ID" },
                showFront: { description: "Flip your ID to show its front side", title: "Show the front of ID" },
                useDifferent: "Use a different ID"
              },
              takingPhoto: "Taking photo..."
            },
            commonIssues: {
              firstStep: "1. Fill the frame with your ID",
              secondStep: "2. Press the button"
            },
            flipAnimation: { title: "Show the back of your ID" }
          },
          selfiev2: {
            manualCapture: {
              instructions: "Center your face in the silhouette and press the button to capture"
            }
          }
        }
      };

      captureFw = window.IDMetricsCaptureFramework;

      try {
        await captureFw.setDetectionProvider(detectionProvider, languageConfig);
        setStatus("SDK ready");
        enableButtons(true);
        console.log("[AID] SDK ready");
      } catch (err) {
        setStatus("Failed to initialize SDK: " + (err?.message || err));
        console.error("[AID] setDetectionProvider error", err);
      }
    };

    // 3) Wire up buttons
    const $ = (id) => document.getElementById(id);

    const btnFront  = $("btn-front");
    const btnBack   = $("btn-back");
    const btnSelfie = $("btn-selfie");

    btnFront.addEventListener("click", async () => {
      await captureIdSide("Front", $("img-front"), $("meta-front"));
    });

    btnBack.addEventListener("click", async () => {
      await captureIdSide("Back", $("img-back"), $("meta-back"));
    });

    btnSelfie.addEventListener("click", async () => {
      await captureSelfie($("img-selfie"), $("meta-selfie"));
    });

    function enableButtons(on) {
      btnFront.disabled  = !on;
      btnBack.disabled   = !on;
      btnSelfie.disabled = !on;
    }

    function setStatus(text) {
      $("status").textContent = text;
    }

    // 4) Helpers to drive the SDK
    async function captureIdSide(side, imgEl, metaEl) {
      // Minimal options â€” you can add captureMode, documentType, theme colors, etc.
      const options = {
        documentSide: side,            // "Front" | "Back"
        documentType: "License",       // or "Passport", "PassportCard" if supported
        captureMode: "Auto"            // "Auto" | "Manual"
      };

      try {
        enableButtons(false);
        setStatus(`Capturing ${side.toLowerCase()}â€¦`);
        const result = await captureFw.scanDocument(options);

        // The SDK typically returns both full and cropped; favor cropped if present
        const img =
          result?.croppedResult     ||
          result?.croppedFrontImage ||
          result?.croppedBackImage  ||
          result?.result            ||
          result?.frontImage        ||
          result?.backImage         ||
          null;

        if (img) {
          imgEl.src = ensureDataUrl(img);
          metaEl.textContent = describeDocResult(result, side);
        } else {
          metaEl.textContent = "No image returned.";
        }

        console.log(`[AID] ${side} result`, result);
        setStatus(`Done: ${side}`);
      } catch (err) {
        console.error(`[AID] scanDocument(${side}) error`, err);
        setStatus(`Error capturing ${side}: ${(err && err.message) || err}`);
      } finally {
        enableButtons(true);
      }
    }

    async function captureSelfie(imgEl, metaEl) {
      try {
        enableButtons(false);
        setStatus("Capturing selfieâ€¦");
        const result = await captureFw.scanSelfie({
          captureMode: "Auto" // or "Manual"
        });

        const img = result?.croppedResult || result?.result || null;
        if (img) {
          imgEl.src = ensureDataUrl(img);
          metaEl.textContent = describeSelfieResult(result);
        } else {
          metaEl.textContent = "No image returned.";
        }

        console.log("[AID] Selfie result", result);
        setStatus("Done: Selfie");
      } catch (err) {
        console.error("[AID] scanSelfie error", err);
        setStatus(`Error capturing selfie: ${(err && err.message) || err}`);
      } finally {
        enableButtons(true);
      }
    }

    // 5) Small utilities
    function ensureDataUrl(data) {
      // The SDK usually returns a data URL already. If itâ€™s base64 only, prepend JPEG header.
      if (typeof data === "string" && data.startsWith("data:")) return data;
      return "data:image/jpeg;base64," + data;
    }

    function describeDocResult(r, side) {
      const focus  = r?.frontFocus ?? r?.backFocus;
      const glare  = r?.frontGlare ?? r?.backGlare;
      const okBits = [
        typeof focus === "number" ? `focus=${focus}` : null,
        typeof glare === "number" ? `glare=${glare}` : null,
      ].filter(Boolean).join(", ");
      return `${side} captured${okBits ? ` (${okBits})` : ""}`;
    }

    function describeSelfieResult(r) {
      // Add any flags you care about (e.g., lenses/mask/eyesClosed if returned by your config)
      return "Selfie captured";
    }
  </script>
</body>
</html>
